<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkVivo Chat Favorites - Settings</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 24px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 32px;
        }
        
        .section {
            margin-bottom: 32px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title-with-action {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 16px;
        }

        .jurisdiction-notice {
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8f1 100%);
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            animation: fadeIn 0.5s ease-in;
        }

        .jurisdiction-notice.strict-consent {
            background: linear-gradient(135deg, #ffeaea 0%, #fff5f5 100%);
            border-color: #dc3545;
        }

        .jurisdiction-notice.opt-in-permissible {
            background: linear-gradient(135deg, #eafaf1 0%, #f5fff8 100%);
            border-color: #28a745;
        }

        .jurisdiction-notice.minimal-requirements {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-color: #6c757d;
        }

        .jurisdiction-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .jurisdiction-flag {
            font-size: 18px;
        }

        .jurisdiction-description {
            font-size: 14px;
            color: #495057;
            line-height: 1.5;
        }

        .ga4-notice {
            background: linear-gradient(135deg, #f0f7ff 0%, #e8f4fd 100%);
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 12px;
            margin: 12px 0;
            font-size: 13px;
            color: #0056b3;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #e9ecef;
        }
        
        .setting-info {
            flex: 1;
        }
        
        .setting-label {
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }
        
        .setting-description {
            font-size: 13px;
            color: #6b7280;
        }
        
        .setting-control {
            margin-left: 16px;
        }
        
        .toggle {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #007bff;
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        .button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .button-primary {
            background: #007bff;
            color: white;
        }
        
        .button-primary:hover {
            background: #0056b3;
        }
        
        .button-secondary {
            background: #6c757d;
            color: white;
        }
        
        .button-secondary:hover {
            background: #545b62;
        }

        .button-danger-small {
            background: #dc2626;
            color: white;
            font-size: 12px;
            padding: 6px 12px;
        }

        .button-danger-small:hover {
            background: #b91c1c;
        }

        .data-management-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            padding-top: 24px;
            border-top: 1px solid #e9ecef;
        }
        
        .status {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .status-icon {
            width: 16px;
            height: 16px;
        }
        
        .hidden {
            display: none;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.2s ease;
            margin-bottom: 16px;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .pinned-chats-controls {
            margin-bottom: 16px;
        }

        .pinned-chats-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .pinned-chat-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #e9ecef;
            background: white;
            cursor: grab;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .pinned-chat-item:last-child {
            border-bottom: none;
        }
        
        .pinned-chat-item.dragging {
            opacity: 0.6;
            transform: rotate(2deg) scale(1.02);
            cursor: grabbing;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            background: #f8fafc;
            border: 2px dashed #3b82f6;
            z-index: 1000;
        }

        .pinned-chat-item:not(.dragging):hover {
            background: #f8f9fa;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .pinned-chat-item.drag-over {
            border-top: 2px solid #007bff;
        }
        
        .drag-handle {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            color: #6b7280;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        .chat-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: white;
        }
        
        .chat-info {
            flex: 1;
            min-width: 0;
        }
        
        .chat-name {
            font-weight: 500;
            color: #374151;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .chat-original-name {
            font-size: 11px;
            color: #9ca3af;
            font-style: italic;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-id {
            font-size: 12px;
            color: #6b7280;
            font-family: monospace;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .chat-actions {
            display: flex;
            gap: 8px;
            margin-left: 12px;
        }
        
        .action-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 4px;
            background: #f3f4f6;
            color: #6b7280;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .action-btn.edit:hover {
            background: #dbeafe;
            color: #2563eb;
        }

        .action-btn.danger:hover {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Focus styles for accessibility */
        .action-btn:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .button:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .toggle input:focus-visible + .slider {
            box-shadow: 0 0 0 2px #3b82f6;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                max-width: none;
                margin: 20px;
                padding: 20px;
            }

            .section-title-with-action {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .chat-actions {
                margin-left: 8px;
                gap: 6px;
            }

            .actions {
                flex-direction: column;
                gap: 8px;
            }

            .button {
                width: 100%;
            }

            .data-management-actions {
                flex-direction: column;
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Dropdown styling */
        .dropdown {
            padding: 10px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            background: linear-gradient(to bottom, #ffffff, #f8f9fa);
            font-size: 14px;
            font-weight: 500;
            color: #2d3748;
            min-width: 180px;
            cursor: pointer;
            transition: all 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .dropdown:hover {
            border-color: #3b82f6;
            background: linear-gradient(to bottom, #ffffff, #f1f5f9);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .dropdown:focus {
            outline: none;
            border-color: #3b82f6;
            background: linear-gradient(to bottom, #ffffff, #f1f5f9);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), 0 4px 12px rgba(59, 130, 246, 0.15);
            transform: translateY(-1px);
        }

        .dropdown option {
            padding: 8px 12px;
            font-weight: 500;
            color: #2d3748;
            background: white;
        }

        .dropdown option:hover {
            background: #f1f5f9;
        }

        /* Hide Windows modifier setting on non-Windows platforms */
        body.mac #windowsModifierSetting,
        body.linux #windowsModifierSetting {
            display: none;
        }

        /* Statistics Grid Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 16px;
        }

        .stat-category {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #e9ecef;
        }

        .stat-category h4 {
            margin: 0 0 12px 0;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-info {
            flex: 1;
        }

        .stat-label {
            font-size: 13px;
            font-weight: 500;
            color: #333;
            margin-bottom: 2px;
        }

        .stat-description {
            font-size: 11px;
            color: #6c757d;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: #007bff;
            min-width: 40px;
            text-align: right;
        }

        .button-secondary-small {
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 500;
        }

        /* Grouped settings with compact layout */
        .settings-group {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .settings-group-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .setting-item-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .setting-item-compact .setting-label {
            font-size: 13px;
            font-weight: 500;
        }

        .setting-item-compact .setting-description {
            font-size: 11px;
        }

        .setting-item-full-width {
            grid-column: 1 / -1;
        }

        /* Nested/dependent settings styling */
        .setting-item-nested {
            background: #f8f9fa;
            border-left: 3px solid #007bff;
            opacity: 0.9;
        }

        .setting-item-nested:disabled,
        .setting-item-nested.disabled {
            opacity: 0.5;
        }

        /* Smaller toggle for nested options */
        .toggle-small {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .toggle-small input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-small .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 20px;
        }

        .toggle-small .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-small input:checked + .slider {
            background-color: #007bff;
        }

        .toggle-small input:checked + .slider:before {
            transform: translateX(20px);
        }

        .toggle-small input:disabled + .slider {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 800px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .setting-item-compact {
                grid-column: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìå WorkVivo Chat Favorites Settings <span id="version-display" style="font-size: 16px; color: rgba(255,255,255,0.7); font-weight: normal;"></span></h1>
            <p>Manage your conversations efficiently</p>
        </div>
        
        <div class="content">
            <div id="status" class="status hidden">
                <svg class="status-icon" viewBox="0 0 24 24" fill="none">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span id="statusText">Settings saved successfully!</span>
            </div>
            
            <!-- Core Features Group -->
            <div class="section">
                <div class="section-title">‚öôÔ∏è Core Features</div>

                <div class="settings-group">
                    <div class="settings-group-title">üìÇ Panels</div>
                    <div class="settings-grid">
                        <!-- Threads Panel -->
                        <div class="setting-item-compact">
                            <div class="setting-info">
                                <div class="setting-label">Threads Panel</div>
                                <div class="setting-description">Quick access to threads</div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle">
                                    <input type="checkbox" id="enableThreadsPanel" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Mentions Panel -->
                        <div class="setting-item-compact">
                            <div class="setting-info">
                                <div class="setting-label">Mentions Panel</div>
                                <div class="setting-description">View all messages that mention you</div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle">
                                    <input type="checkbox" id="enableMentionsPanel" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Search Panel with nested option -->
                        <div class="setting-item-compact" style="flex-direction: column; align-items: stretch;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div class="setting-info">
                                    <div class="setting-label">Search Panel</div>
                                    <div class="setting-description">Advanced search with AND/OR</div>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle">
                                        <input type="checkbox" id="enableSearchPanel" checked data-master-for="overrideSearchButton">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <!-- Nested option inside -->
                            <div style="padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #007bff; display: flex; justify-content: space-between; align-items: center;">
                                <div class="setting-info">
                                    <div class="setting-label" style="font-size: 11px;">Override Search Button</div>
                                    <div class="setting-description" style="font-size: 10px;">Sidebar button opens widget</div>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-small">
                                        <input type="checkbox" id="overrideSearchButton" checked data-depends-on="enableSearchPanel">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Draft Messages with nested option -->
                        <div class="setting-item-compact" style="flex-direction: column; align-items: stretch;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div class="setting-info">
                                    <div class="setting-label">Draft Messages</div>
                                    <div class="setting-description">Auto-save draft messages</div>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle">
                                        <input type="checkbox" id="enableDrafts" checked data-master-for="adasEnabled">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <!-- Nested option inside -->
                            <div style="padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #007bff; display: flex; justify-content: space-between; align-items: center;">
                                <div class="setting-info">
                                    <div class="setting-label" style="font-size: 11px;"><strong>A</strong>ccidental <strong>D</strong>eletion <strong>AS</strong>sistance (ADAS)</div>
                                    <div class="setting-description" style="font-size: 10px;">60-second countdown to recover deleted drafts</div>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-small">
                                        <input type="checkbox" id="adasEnabled" checked data-depends-on="enableDrafts">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Availability Status -->
                        <div class="setting-item-compact">
                            <div class="setting-info">
                                <div class="setting-label">Availability Status</div>
                                <div class="setting-description">Set and view availability status. Note: You cannot see others' status if disabled</div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle">
                                    <input type="checkbox" id="enableStatusUpdates" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <div class="settings-group-title">‚ö° Quick Action Button</div>
                    <div class="settings-grid">
                        <div class="setting-item-compact setting-item-full-width">
                            <div class="setting-info">
                                <div class="setting-label">Floating Button</div>
                                <div class="setting-description">Draggable floating button for quick access to recent chats and search widget</div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle">
                                    <input type="checkbox" id="floatingWidgetEnabled" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item-compact">
                            <div class="setting-info">
                                <div class="setting-label">First Click Action</div>
                                <div class="setting-description">Single-click behavior</div>
                            </div>
                            <div class="setting-control">
                                <select id="floatingWidgetFirstClick" class="dropdown">
                                    <option value="recents">Recent Chats</option>
                                    <option value="search">Open Search</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item-compact">
                            <div class="setting-info">
                                <div class="setting-label">Button Color</div>
                                <div class="setting-description">Floating button color</div>
                            </div>
                            <div class="setting-control">
                                <input type="color" id="floatingButtonColor" value="#007ACC" style="width: 50px; height: 32px; border: 2px solid #e1e5e9; border-radius: 6px; cursor: pointer;">
                            </div>
                        </div>

                        <div class="setting-item-compact setting-item-full-width" style="flex-direction: column; align-items: stretch;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div class="setting-info">
                                    <div class="setting-label">Auto-redirect to Chat</div>
                                    <div class="setting-description">Auto-navigate to chat page when using features outside chat</div>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle">
                                        <input type="checkbox" id="autoRedirectToChat" checked data-master-for="lastChatPageUrl,editChatUrlBtn,clearChatUrlBtn">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- Nested URL field inside -->
                            <div style="padding: 12px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #007bff;">
                                <div class="setting-info">
                                    <div class="setting-label" style="font-size: 11px;">Saved Chat Page URL</div>
                                    <div class="setting-description" style="font-size: 10px;">The URL to redirect to when using features outside chat page</div>
                                    <div style="margin-top: 8px; display: flex; align-items: center; gap: 8px;">
                                        <input type="text" id="lastChatPageUrl"
                                               placeholder="No chat page URL saved yet. Visit a chat page to save one automatically."
                                               style="flex: 1; padding: 8px; border: 1px solid #e1e5e9; border-radius: 4px; font-size: 11px; font-family: monospace; background: white;"
                                               readonly
                                               data-depends-on="autoRedirectToChat">
                                        <button id="editChatUrlBtn" class="button button-secondary-small" style="white-space: nowrap; font-size: 10px; padding: 4px 8px;" data-depends-on="autoRedirectToChat">
                                            ‚úèÔ∏è Edit
                                        </button>
                                        <button id="clearChatUrlBtn" class="button button-secondary-small" style="white-space: nowrap; font-size: 10px; padding: 4px 8px;" data-depends-on="autoRedirectToChat">
                                            üóëÔ∏è Clear
                                        </button>
                                    </div>
                                    <div style="font-size: 10px; color: #6b7280; margin-top: 6px;">
                                        üí° <strong>Tip:</strong> Visit any chat page to automatically save its URL, or click "Edit" to set a custom URL.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <div class="settings-group-title">üìå Pinned Chats Display</div>
                    <div class="settings-grid">
                        <!-- Show Pinned Sidebar with all nested options inside -->
                        <div class="setting-item-compact setting-item-full-width" style="flex-direction: column; align-items: stretch;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <div class="setting-info">
                                    <div class="setting-label">Show Pinned Sidebar</div>
                                    <div class="setting-description">Display pinned chats section at top of sidebar</div>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle">
                                        <input type="checkbox" id="showPinnedSidebar" checked data-master-for="pinnedChatsLayout,autoCollapse,showScrollbar,showPinIndicator">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- Nested options inside parent box -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                <!-- Layout Type -->
                                <div style="padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #007bff; display: flex; justify-content: space-between; align-items: center;">
                                    <div class="setting-info">
                                        <div class="setting-label" style="font-size: 11px;">Layout Type</div>
                                        <div class="setting-description" style="font-size: 10px;">Display style</div>
                                    </div>
                                    <div class="setting-control">
                                        <select id="pinnedChatsLayout" class="dropdown" data-depends-on="showPinnedSidebar" style="font-size: 11px; padding: 4px 8px; min-width: 100px;">
                                            <option value="carousel">Carousel</option>
                                            <option value="grid-3">Grid 3</option>
                                            <option value="grid-4">Grid 4</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Auto-collapse -->
                                <div style="padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #007bff; display: flex; justify-content: space-between; align-items: center;">
                                    <div class="setting-info">
                                        <div class="setting-label" style="font-size: 11px;">Auto-collapse</div>
                                        <div class="setting-description" style="font-size: 10px;">Collapse when empty</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-small">
                                            <input type="checkbox" id="autoCollapse" checked data-depends-on="showPinnedSidebar">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Show Scrollbar -->
                                <div style="padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #007bff; display: flex; justify-content: space-between; align-items: center;">
                                    <div class="setting-info">
                                        <div class="setting-label" style="font-size: 11px;">Show Scrollbar</div>
                                        <div class="setting-description" style="font-size: 10px;">Bottom scrollbar in carousel</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-small">
                                            <input type="checkbox" id="showScrollbar" checked data-depends-on="showPinnedSidebar">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Pin Indicator -->
                                <div style="padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #007bff; display: flex; justify-content: space-between; align-items: center;">
                                    <div class="setting-info">
                                        <div class="setting-label" style="font-size: 11px;">Pin Indicator</div>
                                        <div class="setting-description" style="font-size: 10px;">Green pin icon on avatars</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-small">
                                            <input type="checkbox" id="showPinIndicator" checked data-depends-on="showPinnedSidebar">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- Google Meet Integration Section -->
            <div class="section">
                <div class="section-title">
                    üìπ Google Meet Integration
                </div>
                <p style="color: #6b7280; margin-bottom: 20px; font-size: 14px;">
                    Connect your Google account to create instant Google Meet links directly from chat.
                </p>

                <div id="googleMeetStatus" style="padding: 16px; border-radius: 8px; margin-bottom: 16px; display: none; background: #f0f7ff; border: 1px solid #b3d9ff;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div id="googleMeetAvatar" style="width: 48px; height: 48px; border-radius: 50%; background: #f3f4f6; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; border: 2px solid #e5e7eb;">
                            üë§
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div id="googleMeetName" style="font-weight: 600; color: #1f2937; margin-bottom: 2px; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
                            <div id="googleMeetEmail" style="font-size: 13px; color: #6b7280; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
                        </div>
                        <button id="googleSignOutBtn" class="button button-secondary" style="flex-shrink: 0;">
                            Sign Out
                        </button>
                    </div>
                </div>

                <div id="googleMeetSignIn" style="text-align: center; padding: 32px 16px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                    <div style="font-size: 48px; margin-bottom: 16px;">üìπ</div>
                    <h3 style="font-size: 18px; font-weight: 600; color: #374151; margin-bottom: 8px;">Connect Google Account</h3>
                    <p style="font-size: 14px; color: #6b7280; margin-bottom: 20px;">
                        Sign in with Google to enable instant meeting creation
                    </p>
                    <button id="googleSignInBtn" class="button button-primary">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="currentColor" style="margin-right: 8px;">
                            <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
                            <path d="M9.003 18c2.43 0 4.467-.806 5.956-2.18L12.05 13.56c-.806.54-1.837.86-3.047.86-2.344 0-4.328-1.584-5.036-3.711H.96v2.332C2.44 15.983 5.485 18 9.003 18z" fill="#34A853"/>
                            <path d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.71 0-.593.102-1.17.282-1.71V4.96H.957C.347 6.175 0 7.55 0 9.002c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
                            <path d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.428 0 9.003 0 5.485 0 2.44 2.017.96 4.958L3.967 7.29c.708-2.127 2.692-3.71 5.036-3.71z" fill="#EA4335"/>
                        </svg>
                        Sign in with Google
                    </button>
                </div>

                <div class="setting-item" style="margin-top: 16px;">
                    <div class="setting-info">
                        <div class="setting-label">Meeting Invite Text</div>
                        <div class="setting-description">Customize the message that appears before the Google Meet link. Leave empty to send only the link.</div>
                        <input
                            type="text"
                            id="googleMeetInviteText"
                            placeholder="Join the Google Meet using the link: "
                            style="width: 100%; margin-top: 8px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;"
                        />
                        <div style="font-size: 12px; color: #6b7280; margin-top: 6px;">
                            Default: "Join the Google Meet using the link: "
                        </div>
                    </div>
                </div>

                <div class="setting-item" style="margin-top: 16px;">
                    <div class="setting-info">
                        <div class="setting-label">Default Meeting Duration</div>
                        <div class="setting-description">Set the default duration for newly created meetings</div>
                    </div>
                    <div class="setting-control">
                        <select id="googleMeetDuration" class="dropdown">
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60 minutes</option>
                        </select>
                    </div>
                </div>

                <div class="setting-item" style="margin-top: 16px;">
                    <div class="setting-info">
                        <div class="setting-label">Confirm Before Creating</div>
                        <div class="setting-description">Show a confirmation dialog to customize meeting details before creating</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle">
                            <input type="checkbox" id="googleMeetConfirmBeforeCreate">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: #f0f7ff; border: 1px solid #b3d9ff; border-radius: 6px; font-size: 13px; color: #0056b3;">
                    <strong>‚ÑπÔ∏è Note:</strong> The extension only accesses your calendar to create meeting events. No other data is accessed or stored.
                </div>
            </div>

                <div class="settings-group">
                    <div class="settings-group-title">üîî Logging & Notifications</div>
                    <div class="settings-grid">
                        <div class="setting-item-compact">
                            <div class="setting-info">
                                <div class="setting-label">Notifications</div>
                                <div class="setting-description">Show snackbar popups</div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle">
                                    <input type="checkbox" id="showSnackbars" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-item-compact" id="windowsModifierSetting">
                            <div class="setting-info">
                                <div class="setting-label">Modifier Key (Windows)</div>
                                <div class="setting-description">Keyboard shortcut key</div>
                            </div>
                            <div class="setting-control">
                                <select id="windowsModifierKey" class="dropdown">
                                    <option value="ctrl">Ctrl</option>
                                    <option value="alt">Alt</option>
                                    <option value="both">Both</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item-compact">
                            <div class="setting-info">
                                <div class="setting-label">Debug Logging</div>
                                <div class="setting-description">Console logs for troubleshooting</div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle">
                                    <input type="checkbox" id="debugLogging">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title-with-action">
                    <span>üìä Usage Statistics</span>
                    <button id="refreshStatsBtn" class="button button-secondary-small">
                        üîÑ Refresh
                    </button>
                </div>

                <div class="stats-grid">
                    <!-- Search Activity -->
                    <div class="stat-category">
                        <h4>üîç Search Activity</h4>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Search Widget Opened</div>
                                <div class="stat-description">Times the search widget was activated</div>
                            </div>
                            <div class="stat-value">
                                <span id="searchWidgetOpened">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Searches Performed</div>
                                <div class="stat-description">Total number of searches executed</div>
                            </div>
                            <div class="stat-value">
                                <span id="searchesPerformed">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Interactions -->
                    <div class="stat-category">
                        <h4>üí¨ Chat Interactions</h4>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Chat Clicks</div>
                                <div class="stat-description">Times user clicked on chat results</div>
                            </div>
                            <div class="stat-value">
                                <span id="chatClicks">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Chats Pinned</div>
                                <div class="stat-description">Total chats pinned by user</div>
                            </div>
                            <div class="stat-value">
                                <span id="chatsPinned">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Currently Pinned</div>
                                <div class="stat-description">Number of currently pinned chats</div>
                            </div>
                            <div class="stat-value">
                                <span id="currentlyPinned">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Activity -->
                    <div class="stat-category">
                        <h4>üß≠ Navigation Activity</h4>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Chat Switcher Opened</div>
                                <div class="stat-description">Times recent chat switcher was opened</div>
                            </div>
                            <div class="stat-value">
                                <span id="chatSwitcherOpened">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Switcher Selections</div>
                                <div class="stat-description">Chat selections via recent chat switcher</div>
                            </div>
                            <div class="stat-value">
                                <span id="switcherSelections">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Database Statistics -->
                    <div class="stat-category">
                        <h4>üíæ Database Statistics</h4>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Users in Database</div>
                                <div class="stat-description">Total users in Smart Database</div>
                            </div>
                            <div class="stat-value">
                                <span id="usersInDatabase">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Keywords Indexed</div>
                                <div class="stat-description">Total keywords in search index</div>
                            </div>
                            <div class="stat-value">
                                <span id="keywordsIndexed">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-info">
                                <div class="stat-label">Cache Hit Rate</div>
                                <div class="stat-description">Percentage of searches served from cache</div>
                            </div>
                            <div class="stat-value">
                                <span id="cacheHitRate">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Analytics & Privacy Section - Moved to Bottom -->
            <div class="section">
                <div class="section-title">
                    üìä Analytics & Privacy
                </div>
                <p style="color: #6b7280; margin-bottom: 20px; font-size: 14px;">
                    Help improve the extension with optional anonymous analytics.
                </p>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">Usage Analytics</div>
                        <div class="setting-description" id="analyticsDescription">
                            Share anonymous usage data to help improve features and user experience.
                        </div>
                        <div class="ga4-notice" id="ga4Notice" style="display: none;">
                            üìä <strong>Google Analytics 4:</strong> Anonymous usage data is processed via GA4 for product improvement only. No personal data is shared.
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle">
                            <input type="checkbox" id="analyticsEnabled">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">Device & Location Data</div>
                        <div class="setting-description">
                            Share device type and country (detected from browser language) for regional insights.
                            <strong>No precise location</strong> or personal data collected.
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle">
                            <input type="checkbox" id="shareUsageData">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">Error Reporting</div>
                        <div class="setting-description">
                            Automatically send technical errors and crashes for debugging.
                            <strong>Always enabled</strong> to help fix issues quickly.
                        </div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle">
                            <input type="checkbox" id="errorReporting" checked disabled>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">Privacy & Data</div>
                        <div class="setting-description">
                            <a href="https://j6.studio/workvivo-chat-favorites-extension/privacy-policy.html" target="_blank" style="color: #007bff; text-decoration: none;">View Privacy Policy</a><br>
                            <span style="font-size: 12px; color: #6b7280; margin-top: 4px; display: inline-block;">
                                To request data deletion or exercise your privacy rights, email: <strong>j6workz@gmail.com</strong>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button id="resetBtn" class="button button-secondary">
                    üîÑ Reset to Defaults
                </button>
                <div style="color: #6b7280; font-size: 13px; margin-top: 8px;">
                    ‚úÖ Settings are automatically saved when you make changes
                </div>
            </div>

            <div style="text-align: center; padding: 20px 0 8px 0; border-top: 1px solid #e9ecef; margin-top: 24px;">
                <p style="color: #6b7280; font-size: 12px; margin-bottom: 8px;">
                    WorkVivo Chat Favorites by j6
                </p>
                <a href="https://buymeacoffee.com/j6workz" target="_blank" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: #FFDD00; color: #000000; text-decoration: none; border-radius: 6px; font-weight: 500; font-size: 13px; transition: transform 0.2s ease;">
                    <span>‚òï</span>
                    <span>Buy me a coffee</span>
                </a>
            </div>
        </div>
    </div>

    <script src="options.js"></script>
</body>
</html>
